# Сайт Знакомств - Product Requirements Document

## Техническая архитектура

### Технологический стек
- **Backend**: Python Django
- **Frontend**: HTMX для динамических обновлений
- **База данных**: 
  - **SQLAlchemy**: Используется для работы с базой данных без миграций, что упрощает разработку и тестирование.
  - **SQLite in-memory**: Используется для ускорения тестовых запусков, создается при каждом запуске приложения.
- **Шаблоны**: Django Templates
- **Статические файлы**: Django static files
- **Загрузка файлов**: Django FileField

### Структура базы данных
- **Users**: основная информация пользователей
- **Profiles**: детальная информация анкет
- **Photos**: фотографии пользователей
- **Messages**: личные сообщения с timestamp для контроля антиспама
- **Conversations**: переписки между пользователями
- **MessageLimits**: отслеживание количества неотвеченных сообщений по времени

### API и интеграции
- Django REST framework (опционально для будущего расширения)
- HTMX для AJAX-запросов
- Django Forms для валидации
- Django ORM для работы с базой данных

### Требования к инфраструктуре
- Локальная разработка
- SQLite in-memory база данных
- Простой веб-сервер (Django development server)
- Хранение файлов в локальной файловой системе

## План разработки

### Этап 1: Базовая функциональность (MVP)
- Настройка Django проекта
- Модели базы данных
- Система регистрации и авторизации
- Базовое создание анкет
- Простой просмотр анкет
- Создание тестовых данных

### Этап 2: Расширенная функциональность
- Система загрузки фотографий
- Расширенные фильтры поиска
- Система личных сообщений
- **Антиспам ограничения**: механизм отслеживания 10 сообщений в час без ответа
- Пагинация
- Тестовые анкеты с фотографиями

### Этап 3: Оптимизация и улучшения
- Улучшение UI/UX
- Оптимизация производительности
- Тестирование функциональности
- Документация

## Логическая цепочка зависимостей

### Фундамент (Этап 1)
1. **Настройка проекта**: Django проект, настройки, структура
2. **Модели данных**: Users, Profiles, Photos, Messages, MessageLimits
3. **Аутентификация**: Регистрация, вход, сессии
4. **Базовые анкеты**: Создание, редактирование, просмотр
5. **Простой поиск**: Базовые фильтры без пагинации
6. **Тестовые данные**: Создание 5 мужских и 5 женских анкет с фотографиями

### Расширение функциональности (Этап 2)
1. **Фотографии**: Загрузка, валидация, отображение
2. **Расширенные фильтры**: Все параметры поиска
3. **Система сообщений**: Отправка, получение, базовые ограничения
4. **Антиспам механизм**: Отслеживание времени отправки и количества неотвеченных сообщений
5. **Пагинация**: Для анкет и переписок

### Оптимизация (Этап 3)
1. **UI/UX**: Улучшение интерфейса
2. **Производительность**: Оптимизация запросов
3. **Тестирование**: Проверка функциональности антиспама
4. **Документация**: Руководства пользователя

## Риски и их устранение

- **Производительность SQLite in memory.**: Использовать индексы и оптимизировать запросы
- **Загрузка файлов**: Валидация на стороне сервера
- **Безопасность**: Валидация входных данных, защита от XSS
- **Антиспам система**: Эффективное отслеживание временных ограничений
- **Масштабируемость**: Простая архитектура для легкого расширения

### Управление объемом MVP
- **Простота**: Фокус на основных функциях
- **Сложность**: Пошаговая реализация
- **Производительность**: Оптимизация с самого начала
- **Пользовательский опыт**: Интуитивный интерфейс

### Ограничения ресурсов
- **Время разработки**: Использование готовых Django компонентов
- **Инфраструктура**: Локальная разработка
- **Обслуживание**: Простая архитектура
- **Навыки команды**: Django - популярный фреймворк с хорошей документацией

## Приложение

### Антиспам система - детальное описание
- **Ограничение**: Не более 10 сообщений без ответа в течение 1 часа
- **Отслеживание**: Сохранение timestamp каждого отправленного сообщения
- **Проверка ответов**: Отслеживание получения ответов от адресата
- **Сброс счетчика**: Обнуление счетчика при получении ответа
- **Блокировка**: Временная блокировка отправки при превышении лимита
- **Уведомления**: Информирование пользователя о достижении лимита

### Тестовые данные - подробное описание
**Мужские анкеты (5 штук):**
- Возраст: 25, 30, 35, 28, 32
- Различные параметры роста, веса, образования
- Разные города России
- По 2-5 тестовых фотографий на каждую анкету

**Женские анкеты (5 штук):**
- Возраст: 23, 27, 31, 26, 29
- Различные параметры роста, веса, образования
- Разные города России
- По 2-5 тестовых фотографий на каждую анкету

**Тестовые фотографии:**
- Генерируемые placeholder изображения
- Различные размеры в пределах лимитов
- Корректные форматы (JPEG, PNG)
- Автоматическое создание при старте приложения

### Параметры пользователя
- Ник
- Возраст
- Рост
- Вес
- Группа крови и резус фактор
- Пол (мужской/женский)
- Сексуальная ориентация (традиционная/нетрадиционная/любая)
- Семейное положение (не в браке/в браке/разведен/вдовец)
- Цель поиска (найти партнера для зачатия/другое)
- Образование (высшее/среднее/среднее специальное)
- Занятость (имею работу/безработный/студент)
- Отношение к курению (не курю/курю/бросил)
- Отношение к алкоголю (не пью/крайне редко/умеренно)
- Отношение к спорту (занимаюсь/не занимаюсь/время от времени)
- Оценка здоровья (1-10 баллов)
- ВИЧ-инфекция, гепатит (нет/да)
- Способ зачатия (по договоренности/другое)
- Контакт с ребенком (не важно/важно)
- Оплата (без оплаты/с оплатой)

### Желаемые данные партнера
- Ищу среди (женщин-натуралок/женщин-лесбиянок/пар/любых)
- Возраст (от/до/не важно)
- Рост (от/до/не важно)
- Вес (от/до/не важно)
- Тип внешности (европейский/южно-европейский/азиатский/монголоидный/латиноамериканский/негроидный)
- Город (список городов России)
- Наличие детей (нет/есть/не важно)
- Группа крови (не важно/обязательно)
- Обязательно с фотографией (да/нет)

### Фильтры поиска
- Желаемый возраст партнера (от/до/не важно)
- Сексуальная ориентация (традиционная/нетрадиционная/любая)
- Место проживания (страна/регион)
- Желаемый рост (от/до/не важно)
- Желаемый вес (от/до/не важно)
- Наличие детей (нет/есть/не важно)
- Этнический тип (различные типы/не важно)
- Способ зачатия (по договоренности/другое)
- Контакт с ребенком (не важно/важно)
- Оплата (без оплаты/с оплатой)
- Группа крови (не важно/обязательно)
- Обязательно с фотографией (да/нет)
- Количество анкет на странице (50/100)
- Сортировка (по последнему заходу/по дате регистрации)

### Технические спецификации
- Целевая производительность: <2с время загрузки страниц
- Безопасность: Базовая защита Django
- Поддержка браузеров: Chrome, Firefox, Safari, Edge (последние версии)
- Мобильные устройства: Адаптивный дизайн
- Размер файлов: До 10МБ на фото
- Количество фото: До 10 на пользователя
- Пагинация: 50 элементов на страницу
- **Лимит сообщений**: 10 неотвеченных сообщений в течение 1 часа
- **Тестовые данные**: 10 анкет (5 мужских + 5 женских) с 2-5 фото каждая